<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating containers :: Kube-Native Java Apps</title>
    <link rel="canonical" href="https://github.com/redhat-scholars/kube-native-java-apps/kube-native-java-apps/04-containers.html">
    <link rel="prev" href="03-kube-intro.html">
    <link rel="next" href="05-kube-deployment.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://github.com/redhat-scholars/kube-native-java-apps">Kube-Native Java Apps</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="kube-native-java-apps" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">Get Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-bootstrap.html">Bootstrap Quarkus App</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="02-bootstrap.html#devmode">Quarkus dev mode</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="02-bootstrap.html#continuous-testing">Quarkus Continuous Testing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="02-bootstrap.html#configuration">Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="02-bootstrap.html#resteasy-openapi">RestEasy Jackson/OpenAPI</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="02-bootstrap.html#springboot-compat">Spring Boot migration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-kube-intro.html">Introduction to Kubernetes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03-kube-intro.html#sandbox">Getting your OpenShift Sandbox account</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03-kube-intro.html#quay">Getting your Quay account</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-containers.html">Creating containers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#dockerfile">Using Dockerfile</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#jib">Using Jib</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#buildpacks">Using Buildpacks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-kube-deployment.html">Kubernetes Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="05-kube-deployment.html#kube-extension">Kubernetes extension</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="05-kube-deployment.html#customize-resources">Customize created resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-rest-client-fault.html">Rest Client &amp; Fault Tolerance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="06-rest-client-fault.html#rest-client">Create Rest Client</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="06-rest-client-fault.html#fault-tolerance">Fault tolerance on communication with external API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="07-kube-advanced.html">Kubernetes Advanced</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="07-kube-advanced.html">Integration tests to avoid Kubernetes YAML issues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="08-quarkus-cloud-native.html">Quarkus Cloud Native</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="08-quarkus-cloud-native.html#limits">Adjust Resource Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="08-quarkus-cloud-native.html#health">Health check extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="09-panache.html">Hibernate Panache</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="09-panache.html#panache-apps">Create Panache Applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="09-panache.html#dev-services">Dev services</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="09-panache.html#deploy-db">Deploy Database in the sandbox</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="09-panache.html#show-healths">Show Health Checks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="10-metrics.html">Observability</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="10-metrics.html#micrometer">Micrometer</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="10-metrics.html#jaeger">Jaeger</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="11-serverless.html">Going Serverless</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="11-serverless.html#knative-intro">Intro to Knative</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="11-serverless.html#servelessing-service">Serverlessing a service</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="11-serverless.html#native-compile">Compile to native</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="11-serverless.html#deploy-native">Deploy</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="12-bonus-track.html">BONUS - Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="12-bonus-track.html#managed-kafka">Create a Managed Kafka instance</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="12-bonus-track.html#deploy-quarkus-sb">Deploy app in Quarkus using Kafka and Service Binding</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Tutorial</a></li>
    <li><a href="04-containers.html">Creating containers</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/kube-native-java-apps/edit/master/documentation/modules/ROOT/pages/04-containers.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Creating containers</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have our running workload it&#8217;s time that we containerize it !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cli_tools"><a class="anchor" href="#_cli_tools"></a>CLI Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following CLI tools are required for running the exercises in this section.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Please have them installed and configured before you get started with any of the tutorial chapters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Tool</strong></th>
<th class="tableblock halign-left valign-top"><strong>macOS</strong></th>
<th class="tableblock halign-left valign-top"><strong>Fedora</strong></th>
<th class="tableblock halign-left valign-top"><strong>Windows</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Docker</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop for Mac</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dnf install docker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop for Windows</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quay_account"><a class="anchor" href="#_quay_account"></a>Quay account</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By creating your Red Hat Developer account you also have access to <a href="http://quay.io" target="_blank" rel="noopener">Quay</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dockerfile"><a class="anchor" href="#dockerfile"></a>Using dockerfiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Dockerfile is where you&#8217;ll estabilish the definitions used to build a container image. It uses three main keywords/commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FROM: where you&#8217;ll inform the base image used to build your own image</p>
</li>
<li>
<p>ADD: where you&#8217;ll add resources (files) to your image</p>
</li>
<li>
<p>CMD: where you&#8217;ll inform how to start the application</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Sometimes people ask when to use ADD and when to use COPY. Both of them can be used to copy files from the source to destination, but:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ADD: The source can only be the host</p>
</li>
<li>
<p>COPY: The source can be the host or a remote URL</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To let this application ready to be distributed, let&#8217;s package it:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn package</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_a_dockerfile"><a class="anchor" href="#_building_a_dockerfile"></a>Building a Dockerfile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a file named Dockerfile.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">FROM registry.access.redhat.com/ubi8/openjdk-11

ADD target/quarkus-app/lib/ /deployments/lib/
ADD target/quarkus-app/quarkus-run.jar /deployments/app.jar
ADD target/quarkus-app/app/ /deployments/app/
ADD target/quarkus-app/quarkus/ /deployments/quarkus/

CMD ["java", "-jar", "/deployments/app.jar"]</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You might have noticed that Quarkus already created some Dockerfiles for you in <code>src/main/docker</code> and in the end we will be using those. Here we just want you to learn how to craft your own Dockerfile.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_building_the_image"><a class="anchor" href="#_building_the_image"></a>Building the image</h3>
<div class="paragraph">
<p>With the Dockerfile that we created in the last step, let&#8217;s build a container image:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker build -t my-image .</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll seel an output like this:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Sending build context to Docker daemon  10.95MB
Step 1/4 : FROM registry.access.redhat.com/ubi8/openjdk-11
latest: Pulling from ubi8/openjdk-11
396754cf27f9: Pull complete
41e1474940d5: Pull complete
fe52369f78c0: Pull complete
Digest: sha256:98c69a5b81bca0fe331100390c7357c69fd137e8a6228300eda820a0893a1be0
Status: Downloaded newer image for registry.access.redhat.com/ubi8/openjdk-11:latest
 ---&gt; e502114b0d20
Step 2/4 : ADD target/lib/* /deployments/lib/
 ---&gt; 47e879f30cec
Step 3/4 : ADD target/*-runner.jar /deployments/app.jar
 ---&gt; 393bbade30ae
Step 4/4 : CMD ["java", "-jar", "/deployments/app.jar"]
 ---&gt; Running in d09c7708954d
Removing intermediate container d09c7708954d
 ---&gt; 87776d35fc85
Successfully built 87776d35fc85
Successfully tagged my-image:latest</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_listing_the_available_images"><a class="anchor" href="#_listing_the_available_images"></a>Listing the available images</h4>
<div class="paragraph">
<p>To see your just create image, just run:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll see at least these two outputs:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">REPOSITORY                                   TAG                 IMAGE ID            CREATED             SIZE
my-image                                     latest              87776d35fc85        4 minutes ago       516MB
registry.access.redhat.com/ubi8/openjdk-11   latest              e502114b0d20        2 months ago        505MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your image is the <code>my-image</code> and the <code>registry.access.redhat.com/ubi8/openjdk-11</code> is the image used to build yours.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removing_images"><a class="anchor" href="#_removing_images"></a>Removing images</h4>
<div class="paragraph">
<p>To remove your just created image:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker rmi my-image</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_containers"><a class="anchor" href="#_running_containers"></a>Running containers</h3>
<div class="paragraph">
<p>As we removed the image on the previous step, we need to build it again:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker build -t my-image .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to create a container based on this image. Just run:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker create --name my-container my-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>You container is created.</p>
</div>
</div>
<div class="sect2">
<h3 id="_listing_containers"><a class="anchor" href="#_listing_containers"></a>Listing containers</h3>
<div class="paragraph">
<p>To see your just created container:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your output is probably something like this:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</code></pre>
</div>
</div>
<div class="paragraph">
<p>Why your container isn&#8217;t in the list if you&#8217;ve just created it?</p>
</div>
<div class="paragraph">
<p>Because it isn&#8217;t running, and using plain <code>docker ps</code> will only list the running containers. Now try this:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker ps -a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now your output should be something like this:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
ccaadddf1c48        my-image            "java -jar /deployme…"   3 minutes ago       Created                                 my-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s listing all containers, not matter the status. Your container is listed as <code>Created</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_starting_containers"><a class="anchor" href="#_starting_containers"></a>Starting containers</h3>
<div class="paragraph">
<p>To run the container you&#8217;ve just created execute this:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker start my-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check if it&#8217;s running, try the plain <code>docker ps</code> again:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now your output will be like this:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                          NAMES
ccaadddf1c48        my-image            "java -jar /deployme…"   8 minutes ago       Up 54 seconds       8080/tcp, 8443/tcp, 8778/tcp   my-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the status now is <code>Up 54 seconds</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stopping_containers"><a class="anchor" href="#_stopping_containers"></a>Stopping containers</h3>
<div class="paragraph">
<p>To stop your container:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker stop my-container</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_removing_containers"><a class="anchor" href="#_removing_containers"></a>Removing containers</h3>
<div class="paragraph">
<p>To remove your container:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker rm my-container</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_and_starting_a_container_at_once"><a class="anchor" href="#_creating_and_starting_a_container_at_once"></a>Creating and starting a container at once</h3>
<div class="paragraph">
<p>Instead of creating a container and then starting, you can do it at once:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run --name my-container my-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that you terminal is attached to the container process. If you use <code>CTRL+C</code>, the container will stop.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s create a detached container. First we remove this one:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker rm my-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now we create it detached:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -d --name my-container my-image</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_checking_the_log_of_a_container"><a class="anchor" href="#_checking_the_log_of_a_container"></a>Checking the log of a container</h3>
<div class="paragraph">
<p>To see what this container is logging, use this:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker logs my-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to keep following the output:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker logs -f my-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>CTRL+C</code> to stop following the log.</p>
</div>
</div>
<div class="sect2">
<h3 id="_port"><a class="anchor" href="#_port"></a>Port</h3>
<div class="paragraph">
<p>The application running inside your container can be accessed through the port 8080, so let&#8217;s try it:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl localhost:8080/hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should have gotten this output:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">curl: (7) Failed to connect to localhost port 8080: Connection refused</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is happening because we need to explicit expose the ports you need, and we didn&#8217;t do it so far. So let&#8217;s fix it.</p>
</div>
<div class="paragraph">
<p>First let&#8217;s remove the container:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker rm -f my-container</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Did you see something different?</p>
</div>
<div class="paragraph">
<p>We used the <code>-f</code> flag to force the removal of the container even if its running. Be careful when using it!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we re-create the container, but exposing the port 8080:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -d --name my-container -p 8080:8080 my-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s try to reach the application again:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl localhost:8080/hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>You now got this output:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Meaning that your application is now accessible.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pushing_an_image_to_a_public_registry"><a class="anchor" href="#_pushing_an_image_to_a_public_registry"></a>Pushing an image to a public registry</h3>
<div class="paragraph">
<p>So far you&#8217;ve been working with your container image locally. Now let&#8217;s take it to a remote registry.</p>
</div>
<div class="paragraph">
<p>First you&#8217;ll need to tag your image accordingly to your Quay account:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker tag my-image quay.io/rhdevelopers/quarkus-app-workshop</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code>rhdevelopers</code> with your Red Hat Developer username.</p>
</div>
<div class="paragraph">
<p>Also, if you build your image already using the tag, you won&#8217;t need to do this step before pushing it. In our case it would be like this:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker build -t quay.io/rhdevelopers/quarkus-app-workshop .</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
From this point, replace <code>myrepository</code> with the name of your own repository.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you now run <code>docker images</code> you&#8217;ll see something like this:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">REPOSITORY                                   TAG                 IMAGE ID            CREATED             SIZE
my-image                                     latest              a63dec174904        55 minutes ago      516MB
quay.io/rhdevelopers/quarkus-app-workshop    latest              a63dec174904        55 minutes ago      516MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s now ready to be pushed. Before doing it, you just need to login into your Docker Hub account within your terminal:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker login quay.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally you can push it:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker push quay.io/rhdevelopers/quarkus-app-workshop</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By default, in Quay your image won&#8217;t be public. You need to go on the Web Interface, select your image and then go to <code>settings</code> and make it public.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/quay-public.png" alt="Quay Public Repo">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jib"><a class="anchor" href="#jib"></a>Using Jib</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/GoogleContainerTools/jib">Jib</a> builds optimized Docker and OCI images for your Java applications without a Docker daemon - and without deep mastery of Docker best practices.</p>
</div>
<div class="paragraph">
<p>Quarkus comes with an extension for Jib :</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-config hljs" data-lang="config">./mvnw quarkus:add-extension -Dextensions="io.quarkus:quarkus-container-image-jib"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add those properties (but replace with your Quay username):</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.container-image.group=rhdevelopers
quarkus.container-image.registry=quay.io
quarkus.container-image.name=quarkus-app-workshop</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now and push your image in one command :</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-config hljs" data-lang="config">./mvnw clean package -Dquarkus.container-image.push=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can also add this to the properties and each time your build your app the image will also be build and pushed :</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.container-image.push=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="buildpacks"><a class="anchor" href="#buildpacks"></a>Using Buildpacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The extension <code>quarkus-container-image-buildpack</code> is using buildpacks in order to perform container image builds. Under the hood buildpacks will use a Docker daemon for the actual build. While buildpacks support alternatives to Docker, this extension will only work with Docker.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-config hljs" data-lang="config">./mvnw quarkus:add-extension -Dextensions="container-image-buildpack"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to specify a builder image :</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.buildpack.jvm-builder-image=codejive/buildpacks-quarkus-builder</code></pre>
</div>
</div>
<div class="paragraph">
<p>And again now you can build and push your image :</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-config hljs" data-lang="config">./mvnw clean package -Dquarkus.container-image.push=true</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using the buildpack container image extension it is strongly advised to avoid adding <code>quarkus.container-image.build=true</code> in your properties configuration as it might trigger nesting builds within builds. It’s preferable to pass it as an option to the build command instead.
</td>
</tr>
</table>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="03-kube-intro.html">Introduction to Kubernetes</a></span>
  <span class="next"><a href="05-kube-deployment.html">Kubernetes Deployment</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
